# Module: Prompt System Architecture Standard

## Purpose

Определяет архитектуру модульной системы промптов: назначение, структуру, типы модулей и синтаксис композиции.

**Область применения:**
- Описывает общую архитектуру системы
- Определяет типы модулей и их назначение
- Специфицирует синтаксис маркеров включения
- Дополняется правилами из prompt-composition-rules.md

## Specification

### Назначение системы

Система промптов предназначена для работы в составе проекта IT-разработки, для автоматизации создания модулей проекта и их обслуживания в среде IDE.

**Возможности системы:**
- Создание и выполнение промптов (команд) для агентов LLM
- Композиция итоговых промптов из модулей
- Версионирование и раздельная эволюция модулей
- Переиспользование модулей в разных комбинациях
- Переключение контекста для узкоспециализированных задач
- Саморазвитие (создание новых модулей под руководством разработчика)

### Архитектура системы

**Принцип модульности:**

Система позволяет конструировать итоговые промпты из модулей по правилам композиции.

**Преимущества модульного подхода:**
- Поддержка системы в качественном состоянии
- Оперативное обслуживание
- Версионирование модулей
- Раздельная эволюция компонентов
- Переиспользование в разных комбинациях

**Иерархическая структура:**

```
Команды (точки входа)
  ↓
  Модули (переиспользуемые блоки)
    ↓
    Вложенные модули (композиция)
```

### Структура директорий

**Корневая структура:**

```
prompts/
├── commands/          # Команды (точки входа для пользователя)
└── modules/           # Модули (переиспользуемые блоки)
    ├── instructions/  # Пошаговые процедуры
    ├── roles/         # Определения ролей и контекстов
    ├── rules/         # Правила поведения
    └── standards/     # Формальные стандарты
```

### Типы модулей

Все модули размещены в `prompts/modules/`. Тип модуля определяется каталогом размещения.

**1. instructions/**
- Содержит: Пошаговые процедуры и workflow
- Назначение: Определяют КАК выполнять действия
- Примеры: процесс создания модуля, активация роли

**2. roles/**
- Содержит: Определения ролей и профилей
- Назначение: Определяют контекст и область ответственности
- Примеры: prompt engineer, lesson creator, planner

**3. rules/**
- Содержит: Правила, ограничения, запреты
- Назначение: Определяют ЧТО можно/нельзя делать
- Примеры: правила создания модулей, правила композиции

**4. standards/**
- Содержит: Формальные стандарты и спецификации
- Назначение: Определяют ЧТО ТАКОЕ сущности системы
- Примеры: структура модуля, архитектура системы

### Принцип декомпозиции команд

**Универсальный паттерн "Кто-Что-Как":**

Каждая сложная команда декомпозируется на модули по принципу разделения ответственности:

**1. КТО (roles/) - Контекст и роль**
- Определяет: Профиль специалиста, экспертизу, методологию
- Отвечает на: Кто выполняет задачу? Какая область ответственности?
- Пример: `roles/course-indexer.md` - специалист по индексации

**2. ЧТО (standards/) - Формат и спецификация**
- Определяет: Что создаём, формальные требования к результату
- Отвечает на: Какой формат данных? Какая структура?
- Пример: `standards/index-format-standard.md` - форматы индексных файлов

**3. ЧТО МОЖНО/НЕЛЬЗЯ (rules/) - Правила и ограничения**
- Определяет: Допустимые действия, ограничения, запреты
- Отвечает на: Что разрешено? Что запрещено? Какие инварианты?
- Пример: `rules/indexing-rules.md` - правила обработки файлов

**4. КАК (instructions/) - Процесс и workflow**
- Определяет: Пошаговый процесс выполнения задачи
- Отвечает на: Как делать? В какой последовательности?
- Пример: `instructions/course-indexing-workflow.md` - процесс индексации

**Типичная композиция команды:**

```markdown
# Команда: [Название]

## Активация роли
{{prompts/modules/instructions/role-activation.md}}

## Требуемые роли (КТО)
{{prompts/modules/roles/[роль].md}}

## Стандарты (ЧТО)
{{prompts/modules/standards/[стандарт].md}}

## Правила (ЧТО МОЖНО/НЕЛЬЗЯ)
{{prompts/modules/rules/[правила].md}}

## Процесс (КАК)
{{prompts/modules/instructions/[workflow].md}}
```

**Преимущества декомпозиции:**

- **Разделение ответственности** - каждый модуль решает одну задачу
- **Переиспользование** - модули могут использоваться в разных командах
- **Простота изменений** - изменение формата не требует изменения workflow
- **Тестируемость** - каждый аспект можно проверять независимо
- **Понятность** - ясная структура "кто делает, что создаёт, как делает"

**Когда НЕ применять декомпозицию:**

- Простые команды (только переключение роли)
- Задачи без сложной логики
- Одноразовые специфические действия

**Правило:** Декомпозиция оправдана когда:
- Роль имеет сложную методологию
- Результат имеет формальную спецификацию
- Процесс состоит из нескольких фаз
- Правила поведения не тривиальны

### Синтаксис маркеров включения

**Формат маркера:**

Система использует кастомное соглашение проекта для маркировки включаемых модулей:

```
{{путь/к/модулю.md}}
```

**Спецификация:**

- **Открывающий маркер:** `{{` (две фигурные скобки)
- **Путь к файлу:** относительный путь от корня проекта
- **Закрывающий маркер:** `}}` (две фигурные скобки)
- **Формат:** без пробелов внутри маркера

**Примеры синтаксиса:**

```markdown
{{prompts/modules/roles/prompt-creation.md}}
{{prompts/modules/standards/module-structure-standard.md}}
{{prompts/modules/instructions/role-activation.md}}
{{prompts/modules/rules/module-creation-rules.md}}
```

**Характеристики синтаксиса:**

- Не является стандартом Markdown (соглашение проекта)
- Требует ручной обработки агентом LLM
- Визуально похож на Mustache/Handlebars (знакомый синтаксис)
- Поддерживает рекурсивную обработку (маркеры могут быть вложенными)

### Команды системы

**Определение:**

Команда - это точка входа для пользователя в систему промптов.

**Расположение:** `prompts/commands/*.md`

**Характеристики команд:**

- Представляют собой текстовые файлы в формате Markdown
- Содержат маркеры включения модулей
- Являются корнем иерархии модулей (композиции)
- НЕ являются модулями (не имеют структуры Purpose/Specification/Version)
- Не включаются в другие команды или модули

**Назначение:**

Команды используются для запуска конкретных действий пользователем:
- Активации ролей
- Выполнения специализированных задач
- Композиции модулей для достижения цели

### Семантика композиции

**Процесс композиции:**

При обработке маркера `{{путь/к/модулю.md}}` выполняется:

1. Чтение файла модуля
2. Извлечение секции `## Specification`
3. Рекурсивная обработка вложенных маркеров
4. Подстановка результата на место маркера

**Результат композиции:**

Итоговый промпт содержит только исполняемые спецификации модулей, без мета-информации (Purpose/Version).

**Пример композиции:**

```markdown
# Команда: Создание промпта
{{prompts/modules/roles/prompt-creation.md}}
```

Развёртывается в:

```markdown
# Команда: Создание промпта

[Содержимое секции ## Specification из prompt-creation.md]
```

## Version

* Version: 2.1
* Created: 2025-12-24
* Updated: 2025-12-28
* Status: Active
* Changes: Добавлен универсальный принцип декомпозиции команд "Кто-Что-Как" с примерами и рекомендациями применения
